<style>
    .mainDot{
        height: 1rem;
        width: 1rem;
        background-color: red;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        padding: 2px;
    }
    .lightDot{
        height: 2rem;
        width: 2rem;
        background-color: yellow;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        padding: 2px;
    }
    .plugDot{
        height: 2rem;
        width: 2rem;
        background-color: lightgreen;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        padding: 2px;
    }
    .multiPlugDot{
        height: 2rem;
        width: 2rem;
        background-color: green;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        padding: 2px;
    }
</style>
<div class="w3-container w3-center w3-padding">
    <h1 id="roomName"></h1>
</div>

<div class="w3-container" style="width: 100%; height: 30rem;">
    <div class="w3-circle w3-white w3-display-container" style="width: 100%; height: 100%; border: 2px solid black" id="grid">
        <div class="w3-display-bottommiddle" id="content">
            <span class="mainDot"></span>
        </div>
    </div>
</div>

<div class="w3-container w3-padding-32" id="channels_without_position"></div>

<div class="w3-container w3-padding" style="width: 100%;">
    <div class="w3-row">
        <div class="w3-half">
            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="$('#content').load('rooms.mod.html');">
                    <img src="libs/octicons/chevron-left.svg" width="30" height="30" class="w3-circle w3-border"  style="background: #fafafa;">    
            </button>
        </div>

        <div class="w3-half">
            <div class="w3-round w3-red w3-margin w3-padding w3-center" id="rubbish" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <img src="libs/octicons/trashcan.svg" width="30" height="30" class="w3-circle w3-border"  style="background: #fafafa;">
            </div>
        </div>
    </div>
</div>

<div class="w3-modal" id="modal">
    <div class="w3-modal-content">
        <div class="w3-container w3-dark-gray">

            <div class="w3-half w3-padding">
                <label>Client Name</label>
                <input class="w3-input w3-border" type="text" id="clientMac" disabled>
            </div>
            <div class="w3-half w3-padding">
                <label>Client Type</label>
                <input class="w3-input w3-border" type="text" id="clientDescription" disabled>
            </div>

            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="document.getElementById('modal').style.display='none'">Close</button>
            <button class="w3-button w3-circle w3-margin w3-padding" onclick="document.getElementById('modalCron').style.display='block'">
                <img src="libs/octicons/clock.svg" width="30" height="30" class="w3-circle w3-border"  style="background: #fafafa;">
            </button>
            <button class="w3-button w3-circle w3-margin w3-padding" onclick="document.getElementById('modalRelation').style.display='block'">
                <img src="libs/octicons/link.svg" width="30rem" height="30rem" class="w3-circle w3-border"  style="background: #fafafa;">
            </button>

        </div>
    </div>
</div>

<div class="w3-modal" id="modalCron">
    <div class="w3-modal-content">
        <div class="w3-container w3-dark-gray">

            <form class="w3-padding" id="crontab">
            </form>

            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="document.getElementById('modalCron').style.display='none'">Close</button>
            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="putCron()">OK</button>

        </div>
    </div>
</div>

<div class="w3-modal" id="modalRelation">
    <div class="w3-modal-content">
        <div class="w3-container w3-dark-gray">

            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="document.getElementById('modalRelation').style.display='none'">Close</button>
            <button class="w3-button w3-round w3-black w3-margin w3-padding" onclick="putRelation()">OK</button>

        </div>
    </div>
</div>

<script type="text/javascript">

    function putCron(){
        console.log("Crontab created");
        document.getElementById('modalCron').style.display='none';
    }

    function putRelation(){
        console.log("Relation created");
        document.getElementById('modalRelation').style.display='none';
    }

    function allowDrop(event){
        event.preventDefault();
    }

    function drag(event){
        event.dataTransfer.setData('text', event.target.id);
        document.getElementById("rubbish").style.display = 'block';
    }

    function drop(event){
        event.preventDefault();
        var data = event.dataTransfer.getData('text');

        event.target.appendChild(document.getElementById(data));
        localStorage.setItem(data, document.getElementById(data).parentNode.id);

        if(document.getElementById(data).parentNode.id == "rubbish"){
            var container = document.getElementById("channels_without_position");
            container.appendChild(document.getElementById(data));
            localStorage.removeItem(data);
        }

        document.getElementById("rubbish").style.display = 'none';
    }

    $(function () {

        $('#roomName').append(sessionStorage.groupMap);

        document.getElementById('clientMac').placeholder = 'Luz Cocina';
        document.getElementById('clientDescription').placeholder = 'Bombilla';
        document.getElementById("rubbish").style.display = 'none';

        for(var i = 0 ; i < 20 ; i++){

            var grid = document.getElementById("grid");

            var row = document.createElement("div");
            row.className = "w3-row";
            row.style = "height: 5%;";

            var id = "col" + i.toString();
            row.setAttribute('id', id);

            grid.appendChild(row);

            for(var j = 0 ; j < 20 ; j++){

                var col = document.createElement("div");
                col.className = "w3-col";
                col.style = "width: 5%; height: 100%;";

                var id2 = "row" +  i.toString() + "col" + j.toString();
                col.setAttribute('id', id2);
                col.setAttribute('ondrop', 'drop(event)');
                col.setAttribute('ondragover', 'allowDrop(event)');

                var obj = document.getElementById(id);
                obj.appendChild(col);

            }
        }

        $.ajax({
            url: 'https://broker.dalher.net/v3/groups/lists',
            type: 'get',
            headers: {
                "Authorization" : "Bearer " + sessionStorage.access_token
            },
            beforeSend: function(){
                console.log("Obteniendo canales de grupo del Usuario...");
            },
            success: function(response){
                console.log("Obtenidos...");
                var clients = ["light", "plug"];

                for(var i = 0 ; i < response.length ; i++){
                    if(response[i].group == sessionStorage.groupMap){
                        for(var j = 0 ; j < response[i].channels.length ; j++){
                            var channel = response[i].channels[j].channel;
                            var span = document.createElement("span");

                            if(clients[j] == "light"){
                                span.className = "lightDot";
                            }
                            if(clients[j] == "plug"){
                                span.className = "plugDot";
                            }
                            span.setAttribute('id', channel);
                            span.setAttribute('draggable', "true");
                            span.setAttribute('ondragstart', 'drag(event)');
                            span.setAttribute('onclick', "document.getElementById('modal').style.display='block'");

                            if(localStorage.getItem(channel)){
                                var container = document.getElementById(localStorage.getItem(channel) );
                            }
                            else{
                                var container = document.getElementById("channels_without_position");
                            }
                            container.appendChild(span);
                        }
                    }
                }
            },
            error: function(){
                console.log("Error");
                console.log(response);
            }
        });

    });

</script>